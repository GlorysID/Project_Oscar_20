<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Level 1 ‚Äì Gamifikasi HTML: Lengkapin Tag</title>
    <style>
      :root {
        --pri: #2563eb;
        --ok: #16a34a;
        --err: #dc2626;
        --muted: #e5e7eb;
        --chip: #111827;
        --bg: #f8fafc;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: var(--bg);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .shell {
        width: min(960px, 95vw);
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        padding: 20px;
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 18px;
        min-height: 80vh;
      }
      header {
        grid-column: 1/-1;
      }
      h1 {
        margin: 0 0 6px;
        font-size: 1.6rem;
      }
      .sub {
        color: #475569;
        font-size: 0.95rem;
      }

      /* progress */
      .progress {
        height: 12px;
        width: 100%;
        background: var(--muted);
        border-radius: 999px;
        overflow: hidden;
        margin-top: 12px;
      }
      .bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--pri), #22c55e);
        transition: width 0.3s;
      }

      /* left: game board */
      .card {
        background: #f9fafb;
        border: 1px solid #eef2f7;
        border-radius: 14px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 14px;
      }
      .prompt {
        background: #fff;
        border: 1px dashed #cbd5e1;
        border-radius: 12px;
        padding: 14px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        line-height: 1.8;
        overflow-x: auto;
      }
      .slots {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .slot {
        min-width: 90px;
        min-height: 36px;
        background: #fff;
        border: 2px dashed #94a3b8;
        border-radius: 10px;
        padding: 6px 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
        font-family: ui-monospace, monospace;
        user-select: none;
      }
      .slot.filled {
        border-style: solid;
        border-color: #94a3b8;
        color: #0f172a;
      }
      .slot.correct {
        border-color: var(--ok);
        background: #dcfce7;
      }
      .slot.wrong {
        border-color: var(--err);
        background: #fee2e2;
      }

      /* bank */
      .bank {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .chip {
        background: var(--chip);
        color: #fff;
        padding: 8px 12px;
        border-radius: 999px;
        font-family: ui-monospace, monospace;
        cursor: grab;
        user-select: none;
      }
      .chip:active {
        cursor: grabbing;
        transform: scale(0.98);
      }

      /* actions + feedback */
      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      button {
        border: 0;
        border-radius: 10px;
        padding: 10px 14px;
        font-weight: 600;
        cursor: pointer;
      }
      .primary {
        background: var(--pri);
        color: #fff;
      }
      .ghost {
        background: #e2e8f0;
        color: #0f172a;
      }
      .success {
        background: var(--ok);
        color: #fff;
      }
      .danger {
        background: var(--err);
        color: #fff;
      }
      .msg {
        font-weight: 700;
      }
      .msg.ok {
        color: var(--ok);
      }
      .msg.err {
        color: var(--err);
      }
      .hidden {
        display: none;
      }

      /* right: sidebar */
      .side {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .stat {
        background: #f9fafb;
        border: 1px solid #eef2f7;
        border-radius: 14px;
        padding: 14px;
      }
      .stat h3 {
        margin: 0.2rem 0 0.6rem;
        font-size: 1.05rem;
      }
      .list {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
      .pill {
        border-radius: 999px;
        padding: 8px;
        text-align: center;
        font-weight: 700;
        background: #e5e7eb;
      }
      .pill.done {
        background: #dcfce7;
        color: #166534;
      }
      .badge {
        display: flex;
        align-items: center;
        gap: 8px;
        background: #fff;
        border: 1px dashed #cbd5e1;
        border-radius: 12px;
        padding: 12px;
      }
      .badge .icon {
        font-size: 24px;
      }

      .popup-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }

      .popup-card {
        background: #fff;
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        animation: pop 0.3s ease;
      }

      .popup-card h2 {
        margin-bottom: 1rem;
        color: #0f172a;
      }

      .popup-card button {
        margin-top: 1rem;
        padding: 0.7rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      .popup-card button:hover {
        background: #1e40af;
      }

      @keyframes pop {
        from {
          transform: scale(0.8);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* responsive */
      @media (max-width: 900px) {
        .shell {
          grid-template-columns: 1fr;
          min-height: 95vh;
        }

        .reset-btn {
          margin-top: 10px;
          padding: 10px 14px;
          border: none;
          background: #e74c3c;
          color: #fff;
          border-radius: 8px;
          cursor: pointer;
          font-weight: bold;
        }
        .reset-btn:hover {
          background: #c0392b;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header>
        <h1>Level 1 ‚Äî Lengkapin Tag HTML</h1>
        <div class="sub">
          Drag & drop potongan tag ke slot kosong. Selesaikan 8 tantangan buat
          dapet badge <b>HTML Rookie</b>.
        </div>
        <div class="progress"><div id="bar" class="bar"></div></div>
        <button id="resetBtn" class="reset-btn">Reset Progress</button>
      </header>

      <!-- LEFT: GAME -->
      <section class="card">
        <div id="qTitle" class="sub" style="font-weight: 700">
          Tantangan 1/8
        </div>

        <div
          id="instruksiBox"
          class="sub"
          style="font-weight: 600; color: #0f172a"
        ></div>

        <div class="prompt">
          <code id="preview">
            <!-- preview code akan dirender di sini -->
          </code>
        </div>

        <div class="slots" id="slots"></div>

        <div>
          <div style="font-weight: 700; margin-bottom: 6px">Bank Tag:</div>
          <div id="bank" class="bank"></div>
        </div>

        <div class="actions">
          <button id="btnCheck" class="primary">Cek Jawaban</button>
          <button id="btnReset" class="ghost">Reset Susunan</button>
          <span id="feedback" class="msg hidden"></span>
        </div>
      </section>

      <!-- RIGHT: SIDEBAR -->
      <aside class="side">
        <div class="stat">
          <h3>Progress Soal</h3>
          <div id="pillWrap" class="list"></div>
        </div>

        <div class="stat">
          <h3>Aturan Main</h3>
          <ul
            style="
              margin: 0.2rem 0 0.2rem 1rem;
              color: #334155;
              line-height: 1.6;
            "
          >
            <li>Drag potongan tag ke slot kosong.</li>
            <li>Tekan <b>Cek Jawaban</b> untuk menilai.</li>
            <li>Benar = lanjut otomatis ke soal berikutnya.</li>
            <li>Semua benar = dapat badge üéñÔ∏è.</li>
          </ul>
        </div>

        <div id="badgeBox" class="badge hidden">
          <div class="icon">üèÖ</div>
          <div>
            <div style="font-weight: 800">Badge Unlocked!</div>
            <div>HTML Rookie ‚Äî Selesaikan semua tantangan Level 1.</div>
          </div>
        </div>
      </aside>
    </div>

    <script>
      // ======= DATA SOAL (8 tantangan) =======
      // Tiap soal: preview (kode yang ditampilkan), slots (urutan jawaban benar),
      // bank (kumpulan chip: slots + distraktor), hint (opsional)
      const QUIZ = [
        {
          instruksi: "Kasih judul besar di atas teks.",
          preview: `&lt;?&gt; Hello World &lt;?&gt;`,
          slots: ["<h1>", "</h1>"],
          bank: ["<h1>", "</h1>", "<p>", "</p>"],
        },
        {
          instruksi: "Bungkus teks agar jadi paragraf.",
          preview: `&lt;?&gt;Belajar HTML itu seru!&lt;?&gt;`,
          slots: ["<p>", "</p>"],
          bank: ["<p>", "</p>", "<em>", "</em>"],
        },
        {
          instruksi: "Bikin teks jadi miring.",
          preview: `&lt;?&gt;Teks Miring&lt;?&gt;`,
          slots: ["<em>", "</em>"],
          bank: ["<em>", "</em>", "<strong>", "</strong>"],
        },
        {
          instruksi: "Buat teks jadi tebal.",
          preview: `&lt;?&gt;Teks Tebal&lt;?&gt;`,
          slots: ["<strong>", "</strong>"],
          bank: ["<strong>", "</strong>", "<small>", "</small>"],
        },
        {
          instruksi: "Bungkus daftar supaya jadi bullet list.",
          preview: `&lt;?&gt; Item 1&lt;br&gt; Item 2&lt;br&gt; Item 3`,
          slots: ["<ul>", "</ul>"],
          bank: ["<ul>", "</ul>", "<ol>", "</ol>"],
        },
        {
          instruksi: "Kasih judul halaman di tab browser.",
          preview: `&lt;?&gt;Belajar Web&lt;?&gt;`,
          slots: ["<title>", "</title>"],
          bank: ["<title>", "</title>", "<head>", "</head>"],
        },
        {
          instruksi: "Bikin teks jadi link ke Google.",
          preview: `&lt;?&gt;Link ke Google&lt;?&gt;`,
          slots: ['<a href="#">', "</a>"],
          bank: ['<a href="#">', "</a>", "<link>", "<button>"],
        },
        {
          instruksi: "Tambahkan gambar ke halaman.",
          preview: `&lt;? src="foto.jpg" alt="Saya"&gt;`,
          slots: ["<img", "/>"],
          bank: ["<img", "/>", "</img>", "<image>"],
        },
      ];

      // ======= STATE =======
      let idx = 0;
      let answers = Array(QUIZ.length).fill(null); // simpan jawaban per soal
      let done = Array(QUIZ.length).fill(false); // benar/salah final

      // localStorage key (ubah sesuai course/level lu)
      const LS_KEY = "course:HTML:level1:progress";

      // restore progress kalau ada
      const saved = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
      if (saved.idx !== undefined) {
        idx = saved.idx;
      }
      if (saved.answers) answers = saved.answers;
      if (saved.done) done = saved.done;

      // ======= RENDER =======
      const bar = document.getElementById("bar");
      const qTitle = document.getElementById("qTitle");
      const preview = document.getElementById("preview");
      const slotsWrap = document.getElementById("slots");
      const bankWrap = document.getElementById("bank");
      const feedback = document.getElementById("feedback");
      const pillWrap = document.getElementById("pillWrap");
      const badgeBox = document.getElementById("badgeBox");

      function render() {
        const q = QUIZ[idx];
        document.getElementById("instruksiBox").textContent = q.instruksi || "";

        qTitle.textContent = `Tantangan ${idx + 1}/${QUIZ.length}`;
        preview.innerHTML = q.preview.replaceAll(
          "&lt;?&gt;",
          "<span style='color:#22c55e'>[slot]</span>"
        );

        // progress bar
        const doneCount = done.filter(Boolean).length;
        bar.style.width = ((doneCount / QUIZ.length) * 100).toFixed(1) + "%";

        // pills
        pillWrap.innerHTML = "";
        for (let i = 0; i < QUIZ.length; i++) {
          const d = document.createElement("div");
          d.className = "pill" + (done[i] ? " done" : "");
          d.textContent = i + 1;
          d.style.cursor = "pointer";
          d.onclick = () => {
            idx = i;
            save();
            render();
          };
          pillWrap.appendChild(d);
        }

        // slots
        slotsWrap.innerHTML = "";
        const currentAns = answers[idx] || Array(q.slots.length).fill(null);
        for (let i = 0; i < q.slots.length; i++) {
          const s = document.createElement("div");
          s.className = "slot" + (currentAns[i] ? " filled" : "");
          s.dataset.slotIndex = i;
          s.ondragover = (e) => e.preventDefault();
          s.ondrop = (e) => {
            const token = e.dataTransfer.getData("text/plain");
            placeToken(i, token);
          };
          s.textContent = currentAns[i] || "drop here";
          slotsWrap.appendChild(s);
        }

        // bank
        bankWrap.innerHTML = "";
        const bankTokens = buildBankTokens(q, currentAns);
        bankTokens.forEach((tok) => {
          const c = document.createElement("div");
          c.className = "chip";
          c.draggable = true;
          c.textContent = tok;
          c.ondragstart = (e) => e.dataTransfer.setData("text/plain", tok);
          c.onclick = () => {
            // allow tap-to-place ke slot pertama kosong (mobile friendly)
            const firstEmpty = (
              answers[idx] || Array(q.slots.length).fill(null)
            ).findIndex((v) => !v);
            if (firstEmpty > -1) placeToken(firstEmpty, tok);
          };
          bankWrap.appendChild(c);
        });

        // feedback
        feedback.className = "msg hidden";
        feedback.textContent = "";
        // badge state
        badgeBox.classList.toggle("hidden", !(doneCount === QUIZ.length));
      }

      function buildBankTokens(q, currentAns) {
        // bank = semua token unik dari q.bank, minus token yang sudah dipakai di slots
        const used = new Set(currentAns.filter(Boolean));
        return q.bank.filter((tok) => !used.has(tok));
      }

      function placeToken(slotIndex, token) {
        const q = QUIZ[idx];
        let cur = answers[idx] || Array(q.slots.length).fill(null);
        // kalau token sudah ada di slot lain, kosongkan dulu (biar gak duplikasi)
        const alreadyAt = cur.findIndex((t) => t === token);
        if (alreadyAt > -1) cur[alreadyAt] = null;

        cur[slotIndex] = token;
        answers[idx] = cur;
        save();
        render();
      }

      function checkCurrent() {
        const q = QUIZ[idx];
        const cur = answers[idx] || Array(q.slots.length).fill(null);
        // semua harus terisi
        if (cur.some((v) => !v)) {
          showMsg("Isi semua slot dulu ya üîé", false, (soft = true));
          blinkEmpty();
          return;
        }
        // tandai benar/salah di slot
        const slots = [...document.querySelectorAll(".slot")];
        let allCorrect = true;
        for (let i = 0; i < q.slots.length; i++) {
          if (cur[i] === q.slots[i]) {
            slots[i].classList.add("correct");
            slots[i].classList.remove("wrong");
          } else {
            slots[i].classList.add("wrong");
            slots[i].classList.remove("correct");
            allCorrect = false;
          }
        }
        if (allCorrect) {
          done[idx] = true;
          showMsg("Mantap! Jawaban tepat ‚úÖ", true);
          save();
          // lanjut otomatis setelah sedikit jeda
          setTimeout(() => {
            if (idx < QUIZ.length - 1) {
              idx++;
              save();
              render();
            } else {
              render(); // <-- ini biar bar & pill update full
              onFinishLevel();
            }
          }, 700);
        } else {
          showMsg("Masih ada yang melenceng. Coba perbaiki ya ‚ùå", false);
        }
      }

      function blinkEmpty() {
        document.querySelectorAll(".slot").forEach((s) => {
          if (s.textContent === "drop here") {
            s.animate(
              [
                { transform: "scale(1)" },
                { transform: "scale(1.05)" },
                { transform: "scale(1)" },
              ],
              { duration: 300 }
            );
          }
        });
      }

      function resetCurrent() {
        const q = QUIZ[idx];
        answers[idx] = Array(q.slots.length).fill(null);
        document
          .querySelectorAll(".slot")
          .forEach((s) => s.classList.remove("correct", "wrong", "filled"));
        save();
        render();
      }

      function onFinishLevel() {
        // munculin popup
        document.getElementById("nextLevelPopup").style.display = "flex";

        // tombol next
        document.getElementById("nextBtn").onclick = () => {
          document.getElementById("nextLevelPopup").style.display = "none";
          // TODO: arahkan ke level berikutnya (misal redirect)
          window.location.href = "level2.html";
        };
      }

      function showMsg(text, ok, soft = false) {
        feedback.textContent = text;
        feedback.className = "msg " + (ok ? "ok" : "err");
        if (soft) feedback.classList.add("soft");
        feedback.classList.remove("hidden");
      }

      function save() {
        localStorage.setItem(LS_KEY, JSON.stringify({ idx, answers, done }));
      }

      document.getElementById("resetBtn").addEventListener("click", () => {
        if (confirm("Yakin mau reset progress?")) {
          localStorage.removeItem(LS_KEY);
          location.reload();
        }
      });

      // ======= EVENTS =======
      document.getElementById("btnCheck").onclick = checkCurrent;
      document.getElementById("btnReset").onclick = resetCurrent;

      // first render
      render();
    </script>

    <!-- Overlay & Popup Next Level -->
    <div id="nextLevelPopup" class="popup-overlay" style="display: none">
      <div class="popup-card">
        <h2>üéâ Level Selesai!</h2>
        <p>Keren banget, kamu udah nyelesaiin semua soal di level ini.</p>
        <button id="nextBtn">‚û°Ô∏è Lanjut ke Level Berikutnya</button>
      </div>
    </div>
  </body>
</html>
